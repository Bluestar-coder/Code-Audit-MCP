# 需求文档

## 简介

本文档定义了代码审计及POC/EXP生成MCP服务器的需求。该系统旨在为安全研究人员和开发者提供自动化的代码安全审计能力，并能够根据发现的漏洞自动生成概念验证（POC）和漏洞利用（EXP）代码。

## 术语表

- **MCP服务器**: Model Context Protocol服务器，为AI模型提供工具和资源的服务
- **代码审计系统**: 执行静态代码分析以识别安全漏洞的系统
- **POC生成器**: 生成概念验证代码以演示漏洞存在性的组件
- **EXP生成器**: 生成漏洞利用代码以实际利用已识别漏洞的组件
- **漏洞报告**: 包含漏洞详情、严重程度和位置信息的结构化文档
- **审计引擎**: 分析源代码并检测安全问题的核心组件
- **代码扫描器**: 遍历代码库并提取分析所需信息的工具

## 需求

### 需求 1

**用户故事:** 作为安全研究人员，我希望能够扫描目标代码库以识别潜在的安全漏洞，以便评估代码的安全性。

#### 验收标准

1. WHEN 用户提供代码库路径时，代码审计系统 SHALL 扫描所有支持的源代码文件
2. THE 代码审计系统 SHALL 检测常见的安全漏洞类型，包括SQL注入、XSS、命令注入、路径遍历和不安全的反序列化
3. THE 代码审计系统 SHALL 执行数据流分析以追踪用户输入到危险函数的完整路径
4. THE 代码审计系统 SHALL 验证每个检测到的漏洞具有完整的可利用路径
5. WHEN 扫描完成时，代码审计系统 SHALL 仅报告经过验证的、可复现的漏洞
6. THE 代码审计系统 SHALL 为每个检测到的漏洞分配严重程度等级（高、中、低）
7. THE 代码审计系统 SHALL 提供漏洞的精确文件位置、行号和完整的调用链信息


### 需求 2

**用户故事:** 作为安全研究人员，我希望系统能够根据发现的漏洞自动生成POC代码，以便快速验证漏洞的可利用性。

#### 验收标准

1. WHEN 审计引擎识别出漏洞时，POC生成器 SHALL 基于真实的代码路径和上下文生成可执行的概念验证代码
2. THE POC生成器 SHALL 使用实际的函数调用链和参数生成POC代码
3. THE POC生成器 SHALL 生成包含必要注释和使用说明的POC代码
4. THE POC生成器 SHALL 支持多种编程语言的POC生成（Python、JavaScript、Bash）
5. THE POC生成器 SHALL 在POC代码中包含基于真实代码分析的漏洞触发输入数据
6. THE POC生成器 SHALL 验证生成的POC能够准确复现已识别的漏洞
7. WHEN POC生成完成时，POC生成器 SHALL 提供POC代码的执行步骤说明和预期结果

### 需求 3

**用户故事:** 作为渗透测试人员，我希望系统能够生成漏洞利用代码，以便在授权的测试环境中验证系统的安全防护能力。

#### 验收标准

1. WHEN 用户请求生成EXP时，EXP生成器 SHALL 基于已识别的漏洞创建利用代码
2. THE EXP生成器 SHALL 在生成的代码中包含安全警告和使用限制说明
3. THE EXP生成器 SHALL 生成模块化的利用代码，允许自定义目标参数
4. THE EXP生成器 SHALL 提供利用代码的详细技术说明和工作原理
5. IF 漏洞严重程度为高时，THEN EXP生成器 SHALL 在代码中添加额外的警告标识


### 需求 4

**用户故事:** 作为开发者，我希望能够配置审计规则和扫描参数，以便根据项目特点定制化安全检查。

#### 验收标准

1. THE 代码审计系统 SHALL 允许用户指定要扫描的文件类型和目录
2. THE 代码审计系统 SHALL 支持用户自定义漏洞检测规则
3. THE 代码审计系统 SHALL 允许用户排除特定目录或文件模式
4. THE 代码审计系统 SHALL 提供预设的安全规则集（OWASP Top 10、CWE Top 25）
5. WHEN 用户修改配置时，代码审计系统 SHALL 验证配置的有效性并提供反馈

### 需求 5

**用户故事:** 作为MCP客户端用户，我希望通过标准的MCP工具接口访问审计功能，以便将其集成到我的工作流程中。

#### 验收标准

1. THE MCP服务器 SHALL 实现标准的Model Context Protocol规范
2. THE MCP服务器 SHALL 提供用于代码审计的工具接口
3. THE MCP服务器 SHALL 提供用于POC生成的工具接口
4. THE MCP服务器 SHALL 提供用于EXP生成的工具接口
5. THE MCP服务器 SHALL 返回结构化的JSON格式响应数据

### 需求 6

**用户故事:** 作为安全团队成员，我希望审计结果能够以多种格式导出，以便与团队共享和存档。

#### 验收标准

1. THE 代码审计系统 SHALL 支持将审计报告导出为JSON格式
2. THE 代码审计系统 SHALL 支持将审计报告导出为Markdown格式
3. THE 代码审计系统 SHALL 支持将审计报告导出为HTML格式
4. WHEN 导出报告时，代码审计系统 SHALL 包含所有漏洞详情、POC和建议修复方案
5. THE 代码审计系统 SHALL 在导出的报告中包含扫描时间戳和配置信息


### 需求 7

**用户故事:** 作为安全研究人员，我希望系统能够进行深度代码分析以减少误报，以便只关注真实存在的安全问题。

#### 验收标准

1. THE 审计引擎 SHALL 执行污点分析以追踪数据从源头到汇聚点的完整流向
2. THE 审计引擎 SHALL 分析代码中的安全过滤和验证逻辑
3. WHEN 检测到潜在漏洞时，审计引擎 SHALL 验证是否存在有效的安全防护措施
4. IF 存在有效的输入验证或过滤时，THEN 审计引擎 SHALL 不将其标记为漏洞
5. THE 审计引擎 SHALL 分析函数调用的上下文和参数来源
6. THE 审计引擎 SHALL 识别并排除不可达的代码路径
7. WHEN 生成审计报告时，审计引擎 SHALL 提供漏洞可复现性的置信度评分


### 需求 8

**用户故事:** 作为安全研究人员，我希望系统能够提供漏洞点的完整上下文跟踪能力，以便深入理解漏洞的形成过程和影响范围。

#### 验收标准

1. WHEN 识别出漏洞点时，代码审计系统 SHALL 向上追踪所有调用该漏洞函数的位置
2. WHEN 识别出漏洞点时，代码审计系统 SHALL 向下追踪该漏洞点调用的所有子函数
3. THE 代码审计系统 SHALL 追踪漏洞相关参数在整个代码库中的传递路径
4. THE 代码审计系统 SHALL 识别并展示参数的所有变换和处理过程
5. THE 代码审计系统 SHALL 提供跨文件的函数调用链追踪能力
6. THE 代码审计系统 SHALL 展示每个追踪点的代码片段和行号信息
7. THE 代码审计系统 SHALL 识别漏洞参数的原始来源（用户输入、文件读取、网络请求等）
8. WHEN 参数经过多次传递时，代码审计系统 SHALL 记录完整的传递链和每次传递的上下文
9. THE 代码审计系统 SHALL 支持交互式的调用链浏览和导航功能


### 需求 9

**用户故事:** 作为安全研究人员，我希望系统支持多种编程语言的代码审计，以便审计不同技术栈的项目。

#### 验收标准

1. THE 代码审计系统 SHALL 支持PHP代码的安全审计
2. THE 代码审计系统 SHALL 支持Java代码的安全审计
3. THE 代码审计系统 SHALL 支持Python代码的安全审计
4. THE 代码审计系统 SHALL 支持JavaScript/Node.js代码的安全审计
5. THE 代码审计系统 SHALL 自动识别项目使用的编程语言
6. THE 代码审计系统 SHALL 根据不同语言特性应用相应的审计规则
7. THE 代码审计系统 SHALL 支持混合语言项目的审计

### 需求 10

**用户故事:** 作为安全研究人员，我希望系统能够分析第三方依赖的安全风险，以便识别供应链安全问题。

#### 验收标准

1. THE 代码审计系统 SHALL 识别项目中使用的所有第三方依赖库
2. THE 代码审计系统 SHALL 检测依赖库的已知漏洞（CVE）
3. THE 代码审计系统 SHALL 分析危险函数在依赖库中的使用情况
4. THE 代码审计系统 SHALL 检测过时或不安全的依赖版本
5. WHEN 发现有漏洞的依赖时，代码审计系统 SHALL 提供修复建议和安全版本信息
6. THE 代码审计系统 SHALL 支持常见的包管理器（npm、pip、composer、maven）

### 需求 11

**用户故事:** 作为安全研究人员，我希望系统提供灵活的规则引擎，以便自定义和扩展漏洞检测能力。

#### 验收标准

1. THE 代码审计系统 SHALL 提供基于规则的漏洞检测引擎
2. THE 代码审计系统 SHALL 支持用户自定义检测规则
3. THE 代码审计系统 SHALL 支持正则表达式模式匹配规则
4. THE 代码审计系统 SHALL 支持AST（抽象语法树）级别的规则定义
5. THE 代码审计系统 SHALL 允许用户导入和导出规则集
6. THE 代码审计系统 SHALL 提供规则优先级和冲突解决机制
7. WHEN 规则更新时，代码审计系统 SHALL 验证规则的语法正确性


### 需求 12

**用户故事:** 作为安全研究人员，我希望系统能够识别常见的安全漏洞模式，以便快速发现代码中的安全问题。

#### 验收标准

1. THE 代码审计系统 SHALL 检测SQL注入漏洞（包括盲注、时间盲注、堆叠注入）
2. THE 代码审计系统 SHALL 检测跨站脚本攻击（XSS）漏洞（存储型、反射型、DOM型）
3. THE 代码审计系统 SHALL 检测命令注入和代码注入漏洞
4. THE 代码审计系统 SHALL 检测文件包含漏洞（本地文件包含、远程文件包含）
5. THE 代码审计系统 SHALL 检测路径遍历和目录遍历漏洞
6. THE 代码审计系统 SHALL 检测不安全的反序列化漏洞
7. THE 代码审计系统 SHALL 检测SSRF（服务器端请求伪造）漏洞
8. THE 代码审计系统 SHALL 检测XXE（XML外部实体注入）漏洞
9. THE 代码审计系统 SHALL 检测不安全的加密和哈希算法使用
10. THE 代码审计系统 SHALL 检测硬编码的敏感信息（密码、密钥、令牌）
11. THE 代码审计系统 SHALL 检测不安全的随机数生成
12. THE 代码审计系统 SHALL 检测CSRF（跨站请求伪造）防护缺失

### 需求 13

**用户故事:** 作为安全研究人员，我希望系统能够提供详细的漏洞分析报告，以便理解漏洞的技术细节和修复方案。

#### 验收标准

1. WHEN 检测到漏洞时，代码审计系统 SHALL 生成包含漏洞类型、CWE编号和OWASP分类的报告
2. THE 代码审计系统 SHALL 提供漏洞的详细技术描述和攻击原理
3. THE 代码审计系统 SHALL 提供具体的代码修复建议和安全编码示例
4. THE 代码审计系统 SHALL 展示漏洞的完整数据流图和调用关系图
5. THE 代码审计系统 SHALL 评估漏洞的可利用性和业务影响
6. THE 代码审计系统 SHALL 提供相关的安全参考资料和CVE链接
7. WHEN 生成报告时，代码审计系统 SHALL 包含漏洞复现的详细步骤


### 需求 14

**用户故事:** 作为安全研究人员，我希望系统基于AST进行深度代码分析，以便实现精准的结构化代码理解和漏洞检测。

#### 验收标准

1. THE 代码审计系统 SHALL 使用go-tree-sitter或等效技术解析源代码为抽象语法树
2. THE 代码审计系统 SHALL 基于AST进行类定义的精准识别和提取
3. THE 代码审计系统 SHALL 基于AST进行方法定义的精准识别和提取
4. THE 代码审计系统 SHALL 基于AST进行字段定义的精准识别和提取
5. THE 代码审计系统 SHALL 基于AST分析类的继承关系（父类和子类）
6. THE 代码审计系统 SHALL 基于AST分析接口实现关系
7. THE 代码审计系统 SHALL 支持对反编译代码的AST解析和分析
8. THE 代码审计系统 SHALL 使用AST进行精确的作用域分析
9. THE 代码审计系统 SHALL 基于AST识别方法调用的完整签名和参数类型

### 需求 15

**用户故事:** 作为安全研究人员，我希望系统能够建立高效的代码索引，以便快速检索和查询代码结构。

#### 验收标准

1. THE 代码审计系统 SHALL 为解析后的AST建立持久化索引
2. THE 代码审计系统 SHALL 将索引缓存到本地存储以提高后续分析速度
3. WHEN 代码文件未修改时，代码审计系统 SHALL 直接使用缓存的索引数据
4. WHEN 代码文件被修改时，代码审计系统 SHALL 增量更新相关的索引数据
5. THE 代码审计系统 SHALL 支持基于类名的快速检索
6. THE 代码审计系统 SHALL 支持基于方法名的快速检索
7. THE 代码审计系统 SHALL 支持基于字段名的快速检索
8. THE 代码审计系统 SHALL 支持基于继承关系的快速检索
9. THE 代码审计系统 SHALL 提供索引的统计信息（类数量、方法数量、索引大小等）
10. THE 代码审计系统 SHALL 支持索引的导出和导入功能


### 需求 16

**用户故事:** 作为MCP客户端用户，我希望系统通过MCP协议提供智能化的代码分析工具，以便AI能够高效地协助代码审计工作。

#### 验收标准

1. THE MCP服务器 SHALL 注册用于类搜索的MCP工具
2. THE MCP服务器 SHALL 注册用于方法搜索的MCP工具
3. THE MCP服务器 SHALL 注册用于字段搜索的MCP工具
4. THE MCP服务器 SHALL 注册用于继承关系查询的MCP工具
5. THE MCP服务器 SHALL 注册用于调用链分析的MCP工具
6. THE MCP服务器 SHALL 注册用于漏洞扫描的MCP工具
7. THE MCP服务器 SHALL 注册用于POC生成的MCP工具
8. THE MCP服务器 SHALL 注册用于EXP生成的MCP工具
9. THE MCP服务器 SHALL 为每个工具提供清晰的参数定义和使用说明
10. THE MCP服务器 SHALL 返回结构化的JSON响应，包含AST节点信息和代码位置
11. THE MCP服务器 SHALL 支持批量查询以提高AI协作效率
12. WHEN AI请求代码分析时，MCP服务器 SHALL 利用索引快速返回结果

### 需求 17

**用户故事:** 作为安全研究人员，我希望系统能够进行跨语言的代码结构分析，以便审计多语言混合项目。

#### 验收标准

1. THE 代码审计系统 SHALL 为Java语言提供完整的AST解析支持
2. THE 代码审计系统 SHALL 为Python语言提供完整的AST解析支持
3. THE 代码审计系统 SHALL 为JavaScript/TypeScript语言提供完整的AST解析支持
4. THE 代码审计系统 SHALL 为PHP语言提供完整的AST解析支持
5. THE 代码审计系统 SHALL 为Go语言提供完整的AST解析支持
6. THE 代码审计系统 SHALL 统一不同语言的AST表示以支持跨语言分析
7. THE 代码审计系统 SHALL 识别跨语言的函数调用关系（如Java调用Python脚本）
8. WHEN 分析混合语言项目时，代码审计系统 SHALL 建立统一的索引结构


### 需求 18

**用户故事:** 作为AI模型用户，我希望系统能够精确提取所需的代码段，以便减少上下文长度并提高分析效率。

#### 验收标准

1. THE MCP服务器 SHALL 基于AST精确提取类的完整定义代码段
2. THE MCP服务器 SHALL 基于AST精确提取方法的完整定义代码段
3. THE MCP服务器 SHALL 基于AST精确提取属性的完整定义代码段
4. THE MCP服务器 SHALL 基于AST精确提取父类的完整定义代码段
5. THE MCP服务器 SHALL 基于AST精确提取子类的完整定义代码段
6. THE MCP服务器 SHALL 仅返回查询相关的代码段，剔除无关代码
7. THE MCP服务器 SHALL 在返回代码段时包含必要的上下文信息（包名、导入语句）
8. THE MCP服务器 SHALL 优化返回的代码段大小以适应AI模型的上下文窗口限制
9. WHEN 代码段过大时，MCP服务器 SHALL 提供代码段的摘要信息和关键部分
10. THE MCP服务器 SHALL 支持按需加载相关代码段，避免一次性返回过多内容
11. THE MCP服务器 SHALL 提供代码段的行号范围信息，便于精确定位
12. THE MCP服务器 SHALL 过滤掉注释和空行以进一步减少上下文长度（可选）


### 需求 19

**用户故事:** 作为AI模型用户，我希望系统能够智能地组织和返回代码信息，以便AI能够更有效地做出判断和分析。

#### 验收标准

1. THE MCP服务器 SHALL 按照相关性对搜索结果进行排序
2. THE MCP服务器 SHALL 提供代码段的重要性评分以帮助AI优先处理关键代码
3. THE MCP服务器 SHALL 将相关的代码段分组返回（如一个类及其所有方法）
4. THE MCP服务器 SHALL 提供代码段之间的依赖关系信息
5. THE MCP服务器 SHALL 支持渐进式代码加载，先返回概要再按需返回详细内容
6. THE MCP服务器 SHALL 提供代码段的元数据（复杂度、行数、依赖数量等）
7. WHEN 返回多个代码段时，MCP服务器 SHALL 去重并合并重复的依赖项
8. THE MCP服务器 SHALL 提供代码段的简化视图选项，仅包含签名和关键逻辑
9. THE MCP服务器 SHALL 支持分页返回大量搜索结果，避免单次返回过多数据


### 需求 20

**用户故事:** 作为安全研究人员，我希望系统能够追踪危险函数（Sink）的调用链，以便识别从用户输入到危险操作的完整路径。

#### 验收标准

1. THE 代码审计系统 SHALL 识别所有预定义的危险函数（Sink点）
2. THE 代码审计系统 SHALL 支持用户自定义危险函数列表
3. THE 代码审计系统 SHALL 从Sink点向上追踪到所有可能的Source点（用户输入源）
4. THE 代码审计系统 SHALL 识别常见的Source点（HTTP请求参数、文件输入、数据库查询结果等）
5. THE 代码审计系统 SHALL 构建从Source到Sink的完整数据流路径
6. THE 代码审计系统 SHALL 识别数据流路径中的所有中间处理步骤
7. THE 代码审计系统 SHALL 分析数据在传递过程中的类型转换和格式变化
8. WHEN 发现Source到Sink的路径时，代码审计系统 SHALL 验证路径的可达性
9. THE 代码审计系统 SHALL 提供Sink追踪的可视化展示
10. THE MCP服务器 SHALL 注册专门的Sink追踪工具接口
11. THE 代码审计系统 SHALL 支持Java语言的Sink追踪分析
12. THE 代码审计系统 SHALL 识别反射调用中的Sink点

### 需求 21

**用户故事:** 作为安全研究人员，我希望系统提供结构化的审计工作流，以便系统化地进行代码安全审计。

#### 验收标准

1. THE 代码审计系统 SHALL 提供审计项目的创建和管理功能
2. THE 代码审计系统 SHALL 支持审计任务的分阶段执行（信息收集、漏洞扫描、验证、报告）
3. THE 代码审计系统 SHALL 记录审计过程中的所有发现和操作历史
4. THE 代码审计系统 SHALL 支持审计进度的保存和恢复
5. THE 代码审计系统 SHALL 允许用户标记和分类发现的漏洞
6. THE 代码审计系统 SHALL 支持漏洞的优先级排序和状态跟踪
7. THE 代码审计系统 SHALL 提供审计检查清单（Checklist）功能
8. THE 代码审计系统 SHALL 支持多人协作的审计项目
9. WHEN 审计完成时，代码审计系统 SHALL 生成完整的审计报告和统计信息
10. THE 代码审计系统 SHALL 支持审计模板的创建和复用

### 需求 22

**用户故事:** 作为安全研究人员，我希望系统能够智能识别和分析框架特定的安全问题，以便发现框架相关的漏洞。

#### 验收标准

1. THE 代码审计系统 SHALL 识别项目使用的Web框架（Spring、Django、Express等）
2. THE 代码审计系统 SHALL 应用框架特定的安全检查规则
3. THE 代码审计系统 SHALL 检测框架配置中的安全问题
4. THE 代码审计系统 SHALL 识别框架特定的危险函数和API
5. THE 代码审计系统 SHALL 检测ORM框架中的SQL注入风险
6. THE 代码审计系统 SHALL 检测模板引擎中的XSS风险
7. THE 代码审计系统 SHALL 分析框架的认证和授权机制配置
8. THE 代码审计系统 SHALL 检测框架路由配置中的安全问题
9. THE 代码审计系统 SHALL 识别框架中间件的安全配置问题


### 需求 23

**用户故事:** 作为安全研究人员，我希望系统能够进行交互式的代码探索，以便深入分析可疑的代码区域。

#### 验收标准

1. THE MCP服务器 SHALL 提供交互式的代码导航工具
2. THE MCP服务器 SHALL 支持从任意代码点开始的调用链探索
3. THE MCP服务器 SHALL 支持查看函数的所有调用者（Caller）
4. THE MCP服务器 SHALL 支持查看函数的所有被调用者（Callee）
5. THE MCP服务器 SHALL 支持查看变量的所有引用位置
6. THE MCP服务器 SHALL 支持查看类型的所有实例化位置
7. THE MCP服务器 SHALL 提供代码片段的快速跳转功能
8. THE MCP服务器 SHALL 支持符号的定义和引用查找
9. THE MCP服务器 SHALL 提供代码的语义搜索能力（基于功能而非文本）
10. THE MCP服务器 SHALL 支持保存和恢复探索会话


### 需求 24

**用户故事:** 作为安全研究人员，我希望系统能够深度审计依赖库和引用库的代码，以便发现第三方库中的安全问题。

#### 验收标准

1. THE 代码审计系统 SHALL 解析并分析项目依赖的所有第三方库源代码
2. THE 代码审计系统 SHALL 对依赖库执行与主项目相同级别的安全审计
3. THE 代码审计系统 SHALL 识别项目代码对依赖库危险函数的调用
4. THE 代码审计系统 SHALL 分析依赖库之间的传递依赖关系
5. THE 代码审计系统 SHALL 检测依赖库中的供应链攻击风险
6. THE 代码审计系统 SHALL 支持对JAR、AAR、DLL等二进制依赖的反编译和审计
7. THE 代码审计系统 SHALL 识别依赖库中的后门和恶意代码模式
8. THE 代码审计系统 SHALL 分析依赖库的权限和资源访问行为
9. WHEN 发现依赖库漏洞时，代码审计系统 SHALL 追踪项目中受影响的调用点
10. THE 代码审计系统 SHALL 提供依赖库的安全评分和风险等级
11. THE 代码审计系统 SHALL 支持依赖库的白名单和黑名单管理

### 需求 25

**用户故事:** 作为安全研究人员，我希望系统能够查询和关联历史漏洞信息，以便了解类似漏洞的历史和修复方案。

#### 验收标准

1. THE 代码审计系统 SHALL 集成CVE漏洞数据库查询功能
2. THE 代码审计系统 SHALL 集成NVD（国家漏洞数据库）查询功能
3. THE 代码审计系统 SHALL 支持查询特定组件或库的历史漏洞记录
4. THE 代码审计系统 SHALL 提供漏洞的详细信息（CVSS评分、影响版本、修复版本）
5. THE 代码审计系统 SHALL 关联发现的漏洞与已知的CVE编号
6. THE 代码审计系统 SHALL 提供历史漏洞的POC和EXP参考链接
7. THE 代码审计系统 SHALL 支持本地漏洞数据库的缓存和更新
8. THE 代码审计系统 SHALL 提供漏洞趋势分析和统计功能
9. WHEN 检测到新漏洞时，代码审计系统 SHALL 搜索相似的历史漏洞案例
10. THE 代码审计系统 SHALL 提供漏洞修复历史和补丁信息
11. THE MCP服务器 SHALL 注册历史漏洞查询的MCP工具接口
12. THE 代码审计系统 SHALL 支持自定义漏洞数据源的集成

### 需求 26

**用户故事:** 作为安全研究人员，我希望系统能够进行依赖关系的可视化分析，以便理解复杂的依赖结构和风险传播路径。

#### 验收标准

1. THE 代码审计系统 SHALL 生成项目依赖关系的可视化图谱
2. THE 代码审计系统 SHALL 在依赖图中标注存在漏洞的依赖节点
3. THE 代码审计系统 SHALL 展示依赖的传递路径和深度
4. THE 代码审计系统 SHALL 识别并高亮显示关键依赖（被多个模块依赖的库）
5. THE 代码审计系统 SHALL 分析依赖冲突和版本不一致问题
6. THE 代码审计系统 SHALL 提供依赖的许可证信息和合规性检查
7. THE 代码审计系统 SHALL 计算依赖的风险传播影响范围
8. THE 代码审计系统 SHALL 支持依赖图的导出（SVG、PNG、JSON格式）


### 需求 27

**用户故事:** 作为安全研究人员，我希望系统能够深度适配不同编程语言的特性，以便准确识别语言特定的安全问题。

#### 验收标准

1. THE 代码审计系统 SHALL 识别Java语言特有的安全问题（反射、序列化、JNDI注入）
2. THE 代码审计系统 SHALL 识别PHP语言特有的安全问题（变量覆盖、文件包含、代码执行）
3. THE 代码审计系统 SHALL 识别Python语言特有的安全问题（pickle反序列化、eval执行、模板注入）
4. THE 代码审计系统 SHALL 识别JavaScript/Node.js特有的安全问题（原型链污染、事件循环阻塞）
5. THE 代码审计系统 SHALL 识别Go语言特有的安全问题（goroutine泄漏、race condition）
6. THE 代码审计系统 SHALL 识别C/C++语言特有的安全问题（缓冲区溢出、内存泄漏、UAF）
7. THE 代码审计系统 SHALL 理解各语言的类型系统和类型转换规则
8. THE 代码审计系统 SHALL 分析各语言的内存管理机制相关的安全问题
9. THE 代码审计系统 SHALL 识别各语言的并发和多线程安全问题
10. THE 代码审计系统 SHALL 理解各语言的作用域和闭包特性
11. THE 代码审计系统 SHALL 分析各语言的异常处理机制中的安全问题
12. THE 代码审计系统 SHALL 支持各语言的标准库和内置函数的安全分析

### 需求 28

**用户故事:** 作为安全研究人员，我希望系统能够深度适配主流Web框架，以便发现框架特定的安全配置和使用问题。

#### 验收标准

1. THE 代码审计系统 SHALL 深度支持Spring/Spring Boot框架的安全审计
2. THE 代码审计系统 SHALL 分析Spring框架的注解配置安全问题（@RequestMapping、@CrossOrigin）
3. THE 代码审计系统 SHALL 检测Spring Security的配置缺陷
4. THE 代码审计系统 SHALL 深度支持Django框架的安全审计
5. THE 代码审计系统 SHALL 分析Django的ORM查询安全和模板渲染安全
6. THE 代码审计系统 SHALL 深度支持Flask框架的安全审计
7. THE 代码审计系统 SHALL 检测Flask的路由和会话管理安全问题
8. THE 代码审计系统 SHALL 深度支持Express.js框架的安全审计
9. THE 代码审计系统 SHALL 分析Express中间件链的安全配置
10. THE 代码审计系统 SHALL 深度支持Laravel框架的安全审计
11. THE 代码审计系统 SHALL 检测Laravel的Eloquent ORM和Blade模板安全
12. THE 代码审计系统 SHALL 深度支持Struts2框架的安全审计
13. THE 代码审计系统 SHALL 识别Struts2的OGNL注入风险
14. THE 代码审计系统 SHALL 深度支持ASP.NET框架的安全审计
15. THE 代码审计系统 SHALL 分析ASP.NET的ViewState和请求验证机制
16. THE 代码审计系统 SHALL 识别框架的默认配置安全风险
17. THE 代码审计系统 SHALL 理解框架的请求处理生命周期
18. THE 代码审计系统 SHALL 分析框架的数据绑定和验证机制

### 需求 29

**用户故事:** 作为安全研究人员，我希望系统能够适配不同的ORM框架和数据库访问方式，以便准确检测数据层的安全问题。

#### 验收标准

1. THE 代码审计系统 SHALL 深度支持MyBatis框架的SQL注入检测
2. THE 代码审计系统 SHALL 分析MyBatis的动态SQL和参数绑定安全
3. THE 代码审计系统 SHALL 深度支持Hibernate/JPA的安全审计
4. THE 代码审计系统 SHALL 检测HQL/JPQL注入风险
5. THE 代码审计系统 SHALL 深度支持SQLAlchemy的安全审计
6. THE 代码审计系统 SHALL 深度支持Sequelize的安全审计
7. THE 代码审计系统 SHALL 深度支持GORM的安全审计
8. THE 代码审计系统 SHALL 分析原生SQL拼接和参数化查询的使用
9. THE 代码审计系统 SHALL 检测NoSQL注入（MongoDB、Redis等）
10. THE 代码审计系统 SHALL 识别数据库连接字符串中的敏感信息泄露


### 需求 30

**用户故事:** 作为安全研究人员，我希望系统能够适配不同的模板引擎，以便准确检测模板注入和XSS风险。

#### 验收标准

1. THE 代码审计系统 SHALL 深度支持Thymeleaf模板引擎的安全审计
2. THE 代码审计系统 SHALL 深度支持JSP/JSTL的安全审计
3. THE 代码审计系统 SHALL 深度支持FreeMarker模板引擎的安全审计
4. THE 代码审计系统 SHALL 深度支持Velocity模板引擎的安全审计
5. THE 代码审计系统 SHALL 深度支持Jinja2模板引擎的安全审计
6. THE 代码审计系统 SHALL 深度支持EJS模板引擎的安全审计
7. THE 代码审计系统 SHALL 深度支持Handlebars模板引擎的安全审计
8. THE 代码审计系统 SHALL 深度支持Blade模板引擎的安全审计
9. THE 代码审计系统 SHALL 识别模板引擎的SSTI（服务端模板注入）风险
10. THE 代码审计系统 SHALL 分析模板中的XSS防护机制（自动转义）
11. THE 代码审计系统 SHALL 检测模板中的不安全表达式和函数调用
12. THE 代码审计系统 SHALL 识别模板引擎的配置安全问题


### 需求 31

**用户故事:** 作为安全研究人员，我希望系统能够构建完整的项目函数调用关系图，以便全面理解代码的执行流程和依赖关系。

#### 验收标准

1. THE 代码审计系统 SHALL 构建项目级别的完整函数调用关系图
2. THE 代码审计系统 SHALL 支持跨文件的函数调用关系追踪
3. THE 代码审计系统 SHALL 支持跨类的函数调用关系追踪
4. THE 代码审计系统 SHALL 支持跨模块和跨包的函数调用关系追踪
5. THE 代码审计系统 SHALL 识别静态方法调用、实例方法调用和构造函数调用
6. THE 代码审计系统 SHALL 识别接口方法的所有实现类调用
7. THE 代码审计系统 SHALL 识别抽象方法的所有子类实现调用
8. THE 代码审计系统 SHALL 构建双向的调用关系（调用者和被调用者）
9. THE 代码审计系统 SHALL 计算函数的调用深度和调用频率
10. THE 代码审计系统 SHALL 识别递归调用和循环调用
11. THE 代码审计系统 SHALL 提供调用关系图的可视化展示
12. THE 代码审计系统 SHALL 支持调用关系图的导出和持久化
13. THE MCP服务器 SHALL 提供查询函数调用关系的工具接口
14. THE 代码审计系统 SHALL 支持基于调用关系的影响范围分析

### 需求 32

**用户故事:** 作为安全研究人员，我希望系统能够进行函数级污点分析，以便在复杂场景下准确追踪数据流。

#### 验收标准

1. THE 代码审计系统 SHALL 实现基于函数级别的污点分析
2. THE 代码审计系统 SHALL 追踪污点数据在函数间的传递
3. THE 代码审计系统 SHALL 识别函数参数的污点传播
4. THE 代码审计系统 SHALL 识别函数返回值的污点传播
5. THE 代码审计系统 SHALL 处理多线程场景下的污点追踪
6. THE 代码审计系统 SHALL 处理反射调用场景下的污点追踪
7. THE 代码审计系统 SHALL 处理回调函数场景下的污点追踪
8. THE 代码审计系统 SHALL 处理异步调用场景下的污点追踪
9. THE 代码审计系统 SHALL 识别污点数据的净化函数（Sanitizer）
10. THE 代码审计系统 SHALL 分析污点数据经过净化函数后的状态变化
11. THE 代码审计系统 SHALL 避免变量级追踪在复杂场景下的断链问题
12. THE 代码审计系统 SHALL 维护污点传播的完整上下文信息
13. THE 代码审计系统 SHALL 支持自定义污点源和污点汇聚点
14. THE 代码审计系统 SHALL 提供污点传播路径的可视化展示

### 需求 33

**用户故事:** 作为安全研究人员，我希望系统能够自动提取漏洞链路上的完整源代码，以便进行深入的人工或AI分析。

#### 验收标准

1. WHEN 发现漏洞时，代码审计系统 SHALL 自动提取漏洞链路上每个函数的完整源代码
2. THE 代码审计系统 SHALL 按照调用顺序组织提取的源代码
3. THE 代码审计系统 SHALL 为每个函数源代码标注其在漏洞链路中的角色（Source、Propagator、Sink）
4. THE 代码审计系统 SHALL 提取函数的完整定义，包括签名、参数、返回值和函数体
5. THE 代码审计系统 SHALL 提取函数所在类的相关上下文信息
6. THE 代码审计系统 SHALL 提取函数依赖的关键变量和常量定义
7. THE 代码审计系统 SHALL 高亮显示漏洞链路中的关键代码行
8. THE 代码审计系统 SHALL 为提取的代码添加详细的注释说明
9. THE 代码审计系统 SHALL 生成漏洞链路的代码摘要报告
10. THE 代码审计系统 SHALL 支持将提取的代码导出为独立文件
11. THE MCP服务器 SHALL 提供漏洞链路代码提取的工具接口
12. THE 代码审计系统 SHALL 优化提取的代码量，确保包含足够上下文但不冗余
13. THE 代码审计系统 SHALL 支持AI友好的代码格式化和结构化输出
14. THE 代码审计系统 SHALL 提供漏洞链路代码的交互式浏览功能


### 需求 34

**用户故事:** 作为安全研究人员，我希望系统能够使用多模型交叉验证来减少误报，以便提高漏洞检测的准确性。

#### 验收标准

1. THE 代码审计系统 SHALL 实现Self-RAG（自我反思检索增强生成）机制
2. THE 代码审计系统 SHALL 使用多个AI模型对检测结果进行交叉验证
3. THE 代码审计系统 SHALL 对每个检测到的漏洞进行多轮验证
4. THE 代码审计系统 SHALL 计算不同模型验证结果的一致性评分
5. WHEN 模型验证结果不一致时，代码审计系统 SHALL 进行额外的深度分析
6. THE 代码审计系统 SHALL 使用检索增强技术获取相关的历史漏洞案例
7. THE 代码审计系统 SHALL 基于历史案例对当前检测结果进行验证
8. THE 代码审计系统 SHALL 自动过滤低置信度的检测结果
9. THE 代码审计系统 SHALL 提供每个漏洞的验证置信度评分
10. THE 代码审计系统 SHALL 记录验证过程和各模型的判断依据
11. THE 代码审计系统 SHALL 支持用户反馈来优化验证模型
12. THE 代码审计系统 SHALL 有效减少假阳性（误报）率
13. THE 代码审计系统 SHALL 提供验证结果的详细解释和证据链

### 需求 35

**用户故事:** 作为安全研究人员，我希望系统能够使用语义检索和上下文理解技术，以便更智能地分析代码和查找相关信息。

#### 验收标准

1. THE 代码审计系统 SHALL 集成txtai或等效的语义检索引擎
2. THE 代码审计系统 SHALL 为代码库建立语义向量索引
3. THE 代码审计系统 SHALL 支持基于语义的代码搜索（而非仅文本匹配）
4. THE 代码审计系统 SHALL 理解代码的语义含义和功能意图
5. THE 代码审计系统 SHALL 基于语义相似度查找相关代码片段
6. THE 代码审计系统 SHALL 使用语义理解识别功能相似但实现不同的代码
7. THE 代码审计系统 SHALL 基于上下文理解分析代码的实际行为
8. THE 代码审计系统 SHALL 使用语义检索查找相似的漏洞模式
9. THE 代码审计系统 SHALL 提供自然语言查询代码的能力
10. THE 代码审计系统 SHALL 基于语义理解生成更准确的POC和EXP
11. THE MCP服务器 SHALL 提供语义搜索的工具接口
12. THE 代码审计系统 SHALL 使用上下文理解减少误报和漏报
13. THE 代码审计系统 SHALL 支持跨语言的语义代码搜索
14. THE 代码审计系统 SHALL 持续学习和优化语义理解模型


### 需求 36

**用户故事:** 作为安全研究人员，我希望系统能够处理加密混淆和编译后的代码，以便审计各种形式的代码。

#### 验收标准

1. THE 代码审计系统 SHALL 识别常见的代码混淆方式（变量名混淆、控制流混淆、字符串加密）
2. THE 代码审计系统 SHALL 提供代码反混淆功能
3. THE 代码审计系统 SHALL 支持常见混淆工具的还原（ProGuard、Obfuscator、UglifyJS等）
4. THE 代码审计系统 SHALL 支持Java字节码的反编译（.class、.jar文件）
5. THE 代码审计系统 SHALL 支持Android应用的反编译（.apk、.dex文件）
6. THE 代码审计系统 SHALL 支持.NET程序集的反编译（.dll、.exe文件）
7. THE 代码审计系统 SHALL 支持Python字节码的反编译（.pyc文件）
8. THE 代码审计系统 SHALL 支持JavaScript混淆代码的美化和还原
9. THE 代码审计系统 SHALL 识别加密的字符串并尝试解密
10. THE 代码审计系统 SHALL 对反编译后的代码进行AST解析和审计
11. THE 代码审计系统 SHALL 保留反编译前后的映射关系
12. WHEN 遇到无法反混淆的代码时，代码审计系统 SHALL 提供部分分析能力
13. THE 代码审计系统 SHALL 支持自定义反混淆插件
14. THE MCP服务器 SHALL 提供代码反混淆和反编译的工具接口
